<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Timeline | Cantonese Culture in the Americas</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <section class="timeline-wrap">
  <header class="timeline-header">
    <h2>Timeline of Cantonese Migration</h2>
    <p>Scroll left → right (or swipe). Each panel is one phase/event.</p>

    <div class="timeline-controls">
      <button type="button" id="prevBtn">←</button>
      <button type="button" id="nextBtn">→</button>
    </div>
  </header>

  <div class="timeline" id="timeline">
    <!-- PANEL 1 -->
    <article class="panel">
      <div class="panel-meta">
        <span class="tag">Phase I</span>
        <span class="date">17th–19th Centuries</span>
      </div>
      <h3>Early Migration within Southeast Asia</h3>
      <p>
        Following the Qing conquest of South China (c. 1644–1660s), Cantonese migrants moved south by sea…
      </p>
    </article>

    <!-- PANEL 2 -->
    <article class="panel">
      <div class="panel-meta">
        <span class="tag">Event</span>
        <span class="date">1640s–1770s</span>
      </div>
      <h3>Migration to Siam (Thailand)</h3>
      <p>
        Maritime routes linked Guangdong’s coastal communities to Siam, Cambodia, and southern Vietnam…
      </p>
    </article>

    <!-- PANEL 3 -->
    <article class="panel">
      <div class="panel-meta">
        <span class="tag">Event</span>
        <span class="date">1680s–1790s</span>
      </div>
      <h3>Settlement in Southern Vietnam (Cochinchina)</h3>
      <p>
        Mạc Cửu developed Hà Tiên and established a semi-autonomous principality in 1708…
      </p>
    </article>

    <!-- PANEL 4 -->
    <article class="panel">
      <div class="panel-meta">
        <span class="tag">Event</span>
        <span class="date">1786–1820s</span>
      </div>
      <h3>British Ports: Penang & Singapore</h3>
      <p>
        Penang (1786) and Singapore (1819) reshaped migration routes… Ning Yeung Wui Kuan (1822)…
      </p>
    </article>

    <!-- PANEL 5 -->
    <article class="panel">
      <div class="panel-meta">
        <span class="tag">Event</span>
        <span class="date">1840s–1870s</span>
      </div>
      <h3>Tin Mining Expansion in British Malaya</h3>
      <p>
        New migration waves moved from Penang/Singapore into Perak, Selangor, Negeri Sembilan…
      </p>
    </article>

    <!-- PANEL 6 -->
    <article class="panel">
      <div class="panel-meta">
        <span class="tag">Summary</span>
        <span class="date">By late 19th c.</span>
      </div>
      <h3>Population, Social Position, Economic Role</h3>
      <p>
        Tens of thousands regionally; high mobility via brotherhoods & associations; emergence of Taukes…
      </p>
    </article>
  </div>

  <div class="timeline-progress">
    <div class="bar" id="progressBar"></div>
  </div>
</section>

<style>
  .timeline-wrap{
    margin: 32px 0;
    font-family: system-ui,-apple-system,Segoe UI,Roboto;
  }
  .timeline-header h2{ margin: 0 0 6px 0; }
  .timeline-header p{ margin: 0 0 12px 0; opacity: .75; }
  .timeline-controls{ display:flex; gap:8px; margin-bottom: 12px; }
  .timeline-controls button{
    border: 1px solid rgba(0,0,0,.2);
    background: white;
    border-radius: 10px;
    padding: 8px 12px;
    cursor: pointer;
  }

  /* horizontal scroll + snap */
  .timeline{
    display: grid;
    grid-auto-flow: column;
    grid-auto-columns: min(78vw, 520px);
    gap: 14px;
    overflow-x: auto;
    padding: 8px 6px 14px 6px;
    scroll-snap-type: x mandatory;
    scroll-behavior: smooth;
    -webkit-overflow-scrolling: touch;
    border-radius: 14px;
  }
  .timeline::-webkit-scrollbar{ height: 10px; }
  .timeline::-webkit-scrollbar-thumb{ background: rgba(0,0,0,.18); border-radius: 999px; }
  .timeline::-webkit-scrollbar-track{ background: rgba(0,0,0,.06); border-radius: 999px; }

  .panel{
    scroll-snap-align: start;
    border-radius: 16px;
    padding: 16px 16px 14px 16px;
    background: rgba(255,255,255,.92);
    border: 1px solid rgba(0,0,0,.12);
    box-shadow: 0 6px 18px rgba(0,0,0,.08);
  }
  .panel-meta{ display:flex; gap:10px; align-items:center; margin-bottom: 10px; }
  .tag{
    font-size: 12px;
    padding: 3px 8px;
    border-radius: 999px;
    border: 1px solid rgba(0,0,0,.18);
  }
  .date{ font-size: 12px; opacity: .7; }
  .panel h3{ margin: 0 0 8px 0; font-size: 18px; }
  .panel p{ margin: 0; line-height: 1.45; opacity: .9; }

  .timeline-progress{
    height: 6px;
    background: rgba(0,0,0,.08);
    border-radius: 999px;
    overflow: hidden;
    margin-top: 10px;
  }
  .timeline-progress .bar{
    height: 100%;
    width: 0%;
    background: rgba(0,0,0,.45);
    transition: width .1s linear;
  }
</style>

<script>
  const scroller = document.getElementById("timeline");
  const prevBtn = document.getElementById("prevBtn");
  const nextBtn = document.getElementById("nextBtn");
  const progressBar = document.getElementById("progressBar");

  function updateProgress(){
    const max = scroller.scrollWidth - scroller.clientWidth;
    const pct = max <= 0 ? 0 : (scroller.scrollLeft / max) * 100;
    progressBar.style.width = pct + "%";
  }

  function scrollByPanel(dir){
    const panelWidth = scroller.querySelector(".panel")?.getBoundingClientRect().width || 400;
    scroller.scrollBy({ left: dir * (panelWidth + 14), behavior: "smooth" });
  }

  prevBtn.addEventListener("click", () => scrollByPanel(-1));
  nextBtn.addEventListener("click", () => scrollByPanel(1));
  scroller.addEventListener("scroll", updateProgress, { passive: true });
  updateProgress();
</script>


<header>
  <div class="site-title">
    <a href="index.html">Cantonese Culture in the Americas</a>
  </div>
  <nav>
    <a href="index.html">Home</a>
    <a href="timeline.html">Timeline</a>
    <a href="research.html">Research</a>
    <a href="archives.html">Archives</a>
    <a href="resources.html">Resources</a>
  </nav>
</header>

<main>
  <h1>Timeline</h1>
  <p>
    This timeline traces major moments in Cantonese migration from Guangdong to Vietnam and the Americas,
    situating cultural practices within historical events.
  </p>
<!-- ====== START: Integrated Maritime + Flight Routes (East Asia start, no auto-zoom) ====== -->

<link href="https://api.mapbox.com/mapbox-gl-js/v3.17.0/mapbox-gl.css" rel="stylesheet" />

<section style="margin:32px 0;">
  <h2 style="margin:0 0 12px 0; font-family:system-ui,-apple-system,Segoe UI,Roboto;">
    Cantonese Migration Routes
  </h2>
  <div id="diaspora-map" style="width:100%; height:540px; border-radius:14px; overflow:hidden;"></div>
</section>

<script src="https://api.mapbox.com/mapbox-gl-js/v3.17.0/mapbox-gl.js"></script>

<script>
mapboxgl.accessToken =
  "pk.eyJ1Ijoia2V2aW5jYXQxMDAiLCJhIjoiY21qbmFyN21yMTYzMzNlcHN5ZHVubTdpbiJ9.m8QPkEMJKLNIMvFyKUgTkw";

/* ===== Your Studio v0 style ===== */
const STYLE_URL = "mapbox://styles/kevincat100/cmjneo20k000v01sxghqb6aqr";

/* ===== High-contrast route colors ===== */
const C_ROUTE1 = "#3d85c6"; // Si Yi → Ayutthaya (maritime, via Cà Mau)
const C_ROUTE2 = "#e69138"; // Ayutthaya → Hà Tiên → Saigon (maritime)
const C_ROUTE3 = "#6a329f"; // Si Yi → Penang → Singapore (maritime)
const C_ROUTE4 = "#666666"; // Vietnam → California (flight, eastward)
const C_ROUTE5 = "#cc0000"; // Hong Kong → California (flight, eastward)

const ROUTE_WIDTH = 2;      // 线更细
const DASH_BASE = [2, 2];   // 虚线基础
const ANIM_MS = 260;        // 流动速度（越大越慢）

/* ===== Init map: East Asia start; NO fitBounds (prevents zoom out) ===== */
const map = new mapboxgl.Map({
  container: "diaspora-map",
  style: STYLE_URL,
  center: [104.9, 12.6], // Cambodia 附近（Phnom Penh 一带）
  zoom: 4.2,
  bearing: 0,            // 取消旋转（避免“歪”）
  pitch: 0               // 取消倾斜
});


map.addControl(new mapboxgl.NavigationControl(), "top-right");

map.on("load", () => {

  /* ===== Points ===== */
  const points = [
    { title:"Si Yi", subtitle:"Sze Yup region of Guangdong", country:"China", coords:[112.98, 22.54] },
    { title:"Hong Kong", subtitle:"", country:"China", coords:[114.1694, 22.3193] },
    { title:"Ayutthaya Kingdom", subtitle:"Ayutthaya", country:"Thailand", coords:[100.5689, 14.3532] },
    { title:"Hà Tiên", subtitle:"", country:"Vietnam", coords:[104.4833, 10.3833] },
    { title:"Saigon", subtitle:"Ho Chi Minh City", country:"Vietnam", coords:[106.6297, 10.8231] },
    { title:"Penang", subtitle:"", country:"Malaysia", coords:[100.3354, 5.4141] },
    { title:"Singapore", subtitle:"", country:"Singapore", coords:[103.8198, 1.3521] },
    { title:"San Francisco", subtitle:"", country:"United States", coords:[-122.4194, 37.7749] }
  ];

  // markers
  points.forEach(p => {
    const el = document.createElement("div");
    el.style.width = "12px";
    el.style.height = "12px";
    el.style.borderRadius = "999px";
    el.style.background = "#111";      // 点用深色更稳，不抢路线颜色
    el.style.border = "2px solid #fff";
    el.style.boxShadow = "0 1px 6px rgba(0,0,0,.25)";

    const popupHtml = `
      <div style="font-family:system-ui; font-size:13px; line-height:1.25;">
        <div style="font-weight:700;">${escapeHtml(p.title)}</div>
        ${p.subtitle ? `<div style="opacity:.8;">${escapeHtml(p.subtitle)}</div>` : ``}
        <div style="opacity:.6;">${escapeHtml(p.country)}</div>
      </div>
    `;

    new mapboxgl.Marker({ element: el })
      .setLngLat(p.coords)
      .setPopup(new mapboxgl.Popup({ offset: 18 }).setHTML(popupHtml))
      .addTo(map);
  });

  /* ===== Helper: add dashed route ===== */
  function addRoute(id, coords, color) {
    map.addSource(id, {
      type: "geojson",
      data: { type:"Feature", geometry:{ type:"LineString", coordinates: coords } }
    });

    map.addLayer({
      id: id + "-line",
      type: "line",
      source: id,
      layout: { "line-cap":"round", "line-join":"round" },
      paint: {
        "line-color": color,
        "line-width": ROUTE_WIDTH,
        "line-dasharray": DASH_BASE
      }
    });
  }

  /* =========================================================
     ROUTE 1 (Maritime): Si Yi → Ayutthaya
     South China Sea →绕 Cà Mau → Gulf of Thailand
     （不走新加坡/马六甲）
  ========================================================= */
  addRoute("r1", [
    [112.98, 22.54],   // Si Yi
    [114.0, 21.8],     // 出海方向
    [113.2, 20.0],
    [112.0, 18.2],
    [111.0, 16.2],
    [110.2, 14.5],
    [109.5, 13.2],
    [109.0, 11.8],
    [108.2, 10.5],
    [106.8, 9.2],
    [105.2, 8.8],      // 贴近 Cà Mau 外海
    [103.6, 8.9],
    [102.0, 9.2],      // 入泰国湾
    [101.0, 10.2],
    [100.6, 12.0],
    [100.5689, 14.3532] // Ayutthaya
  ], C_ROUTE1);

  /* =========================================================
     ROUTE 2 (Maritime): Ayutthaya → Hà Tiên → Saigon
  ========================================================= */
  addRoute("r2", [
    [100.5689, 14.3532],
    [101.0, 12.8],
    [101.6, 11.6],
    [102.4, 10.9],
    [103.3, 10.6],
    [104.0, 10.5],
    [104.4833, 10.3833], // Hà Tiên
    [104.9, 10.0],
    [105.6, 9.6],
    [106.1, 9.8],
    [106.4, 10.2],
    [106.6297, 10.8231]  // Saigon
  ], C_ROUTE2);

  /* =========================================================
     ROUTE 3 (Maritime): Si Yi → Penang → Singapore
  ========================================================= */
  addRoute("r3", [
    [112.98, 22.54],
    [113.6, 20.5],
    [112.6, 18.0],
    [111.0, 15.0],
    [109.5, 12.5],
    [107.8, 10.2],
    [105.8, 8.2],
    [103.5, 6.8],
    [101.8, 6.0],
    [100.3354, 5.4141],  // Penang
    [101.6, 4.1],
    [102.7, 2.7],
    [103.3, 2.0],
    [103.8198, 1.3521]   // Singapore
  ], C_ROUTE3);

  /* =========================================================
     ROUTE 4 (Flight, eastward): Vietnam → California
     说明：用“向东控制点”做航空弧线示意（不考虑日期变更）
  ========================================================= */
  addRoute("r4", [
    [106.6297, 10.8231],   // Saigon
    [122.0, 18.0],
    [138.0, 26.0],
    [154.0, 33.0],
    [170.0, 38.0],
    [186.0, 40.5],
    [202.0, 41.5],
    [218.0, 40.5],
    [232.0, 39.2],
    [237.5806, 37.7749]    // San Francisco (-122.4194 + 360)
  ], C_ROUTE4);

  /* =========================================================
     ROUTE 5 (Flight, eastward): Hong Kong → California
  ========================================================= */
  addRoute("r5", [
    [114.1694, 22.3193],   // Hong Kong
    [130.0, 28.0],
    [146.0, 34.0],
    [162.0, 39.0],
    [176.0, 43.0],
    [190.0, 45.0],
    [206.0, 44.5],
    [222.0, 42.5],
    [233.0, 40.5],
    [237.5806, 37.7749]    // San Francisco
  ], C_ROUTE5);

  /* ===== Animated dashed lines (all routes) ===== */
  const dashSeq = [
    [0,4,3],[0.5,4,2.5],[1,4,2],[1.5,4,1.5],
    [2,4,1],[2.5,4,0.5],[3,4,0]
  ];
  const animatedLayers = ["r1-line","r2-line","r3-line","r4-line","r5-line"];

  let step = 0;
  setInterval(() => {
    const d = dashSeq[step];
    animatedLayers.forEach(id => {
      if (map.getLayer(id)) map.setPaintProperty(id, "line-dasharray", d);
    });
    step = (step + 1) % dashSeq.length;
  }, ANIM_MS);
});

function escapeHtml(str) {
  return String(str).replace(/[&<>"']/g, m =>
    ({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;" }[m])
  );
}
</script>

<!-- ====== END: Integrated Maritime + Flight Routes ====== -->





  <p><em>（You can embed TimelineJS or StoryMapJS here later）</em></p>
</main>

<footer>
  <p>© Cantonese Culture in the Americas</p>
</footer>

</body>
</html>
