<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Timeline | Cantonese Culture in the Americas</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="style.css">
</head>
  <header class="page-header">
  <h1>Timeline of Cantonese Migration</h1>
  <p class="page-subtitle">
    Maritime networks, regional settlement, and overseas mobility in Southeast Asia
    (17th–19th centuries)
  </p>
</header>

<body>
  <section class="tl-wrap">
  <header class="tl-header">
    <h2>Timeline of Cantonese Migration</h2>
    <p class="tl-sub">
      Click the arrows to move through panels. The current panel is enlarged; neighboring panels are previews.
      (Long text scrolls inside the card.)
    </p>
  </header>

  <div class="tl-stage" id="tlStage" aria-label="Timeline carousel">
    <button type="button" class="tl-arrow tl-left" id="tlPrev" aria-label="Previous">‹</button>
    <button type="button" class="tl-arrow tl-right" id="tlNext" aria-label="Next">›</button>

    <div class="tl-track" id="tlTrack">

      <!-- CARD 1: Phase -->
      <article class="tl-card">
        <div class="tl-meta">
          <span class="tl-tag">Phase I</span>
          <span class="tl-date">17th–19th Centuries</span>
        </div>
        <h3>Early Migration within Southeast Asia</h3>
        <div class="tl-body">
          <p>This phase traces early Cantonese migration networks across Southeast Asia from the 17th to 19th centuries, focusing on Siam (Thailand), southern Vietnam (Cochinchina), and later British colonial ports in Malaya and Singapore.</p>
        </div>
      </article>

      <!-- CARD 2: Siam -->
      <article class="tl-card">
        <div class="tl-meta">
          <span class="tl-tag">Event</span>
          <span class="tl-date">1640s–1770s</span>
        </div>
        <h3>Migration to Siam (Thailand)</h3>
        <div class="tl-body">
          <p>Following the Qing dynasty’s conquest of South China (c. 1644–1660s), large numbers of Cantonese people migrated overseas. Anti-Qing Ming loyalists and refugees fled south by sea to escape warfare, while widespread corruption and hardship under Qing rule left many farmers and artisans unable to survive locally, forcing them to seek livelihoods abroad.</p>
          <p>Maritime routes linked Guangdong’s coastal communities to Siam (Thailand), Cambodia, and southern Vietnam (Cochinchina under the Nguyễn lords), where local rulers and economies welcomed Cantonese traders and skilled workers for their commercial and fiscal value, strengthening the pull toward Southeast Asia.</p>
          <p>By around 1700, the Chinese population in Ayutthaya (the former Thai kingdom) reportedly exceeded 3,000 and expanded significantly over the 18th century, with Cantonese immigrants becoming prominent in royal monopoly trade, navigation, commerce, and urban crafts. These Cantonese networks became increasingly influential in Siam’s port trade by the late 1700s.</p>
        </div>
      </article>

      <!-- CARD 3: Cochinchina -->
      <article class="tl-card">
        <div class="tl-meta">
          <span class="tl-tag">Event</span>
          <span class="tl-date">1680s–1790s</span>
        </div>
        <h3>Settlement in Southern Vietnam (Cochinchina)</h3>
        <div class="tl-body">
          <p>Around 1680, Mạc Cửu (Mo Jiu)—a refugee from Leizhou, Guangdong—began developing the Hà Tiên area and formally established his semi-autonomous principality at Hà Tiên (near the Vietnam–Cambodia border) in 1708, when he placed it under the suzerainty of the Vietnamese Nguyễn lords.</p>
          <p>This polity functioned as a sanctuary and a major hub for Cantonese and other Chinese migrants before French colonization, linking frontier settlement, maritime trade, and the political protection of Nguyễn rule.</p>
          <p>During the Tây Sơn conflicts, ethnic Chinese merchants—primarily Cantonese—founded a new settlement adjacent to Saigon (Ho Chi Minh City, Vietnam) in 1778. This settlement later became Chợ Lớn (“Big Market”). It developed into the most significant Cantonese commercial diaspora enclave in Indochina.</p>
          <p>The community suffered severe violence (notably in 1782), but survivors rebuilt, laying the foundations for Saigon’s enduring Chinatown. By the end of the 18th century, historical records indicate the Cantonese population in Cochinchina (Southern Vietnam) reached an estimated 30,000–40,000, controlling key rice and silk trade routes.</p>
        </div>
      </article>

      <!-- CARD 4: Penang & Singapore -->
      <article class="tl-card">
        <div class="tl-meta">
          <span class="tl-tag">Event</span>
          <span class="tl-date">1786–1820s</span>
        </div>
        <h3>British Ports: Penang & Singapore</h3>
        <div class="tl-body">
          <p>From the late 18th century, British colonial ports reshaped Guangdong migration routes, and Penang (1786) offered security and strong commercial prospects that drew migrants already circulating in the region.</p>
          <p>In the 1790s, the Ghee Hin Kongsi (义兴公司) emerged as one of the earliest major Chinese brotherhoods in Penang and was strongly associated with Cantonese networks, helping organize labor, protection, and mutual aid while anchoring Cantonese community life in the Straits Settlements.</p>
          <p>After Singapore (1819) was established as a British entrepôt, Cantonese migrants moved into the colony’s expanding economy, and in 1822 the first Cantonese dialect association, the Ning Yeung Wui Kuan (宁阳会馆), was established by Cho Ah Chee, a carpenter from Taishan (then Xinning) who had accompanied Raffles from Penang.</p>
          <p>This marked a major moment of institutional consolidation for the Cantonese community organization in Singapore alongside other dialect groups, reinforcing the role of associations in lodging, employment, welfare, dispute resolution, and collective representation.</p>
        </div>
      </article>

      <!-- CARD 5: Tin mining -->
      <article class="tl-card">
        <div class="tl-meta">
          <span class="tl-tag">Event</span>
          <span class="tl-date">1840s–1870s</span>
        </div>
        <h3>Tin Mining Expansion in British Malaya</h3>
        <div class="tl-body">
          <p>With the discovery of massive tin deposits in Perak, Selangor, and Negeri Sembilan, a new wave of migration occurred across the 1840s–1870s, as Cantonese laborers and capitalists moved from Penang and Singapore into interior mining districts.</p>
        </div>
      </article>

      <!-- CARD 6: Summary -->
      <article class="tl-card">
        <div class="tl-meta">
          <span class="tl-tag">Summary</span>
          <span class="tl-date">By late 19th c.</span>
        </div>
        <h3>Population Scale, Social Position, and Economic Role</h3>
        <div class="tl-body">
          <p>By the turn of the 19th century, the total Southern Asia overseas Cantonese population was relatively modest, numbering in the tens of thousands. The Cantonese community occupied a unique niche in the colonial hierarchy.</p>
          <p>While the majority arrived as indentured laborers (coolies) or artisans, the community possessed high social mobility. Through the Ghee Hin brotherhoods and clan associations, they organized labor and capital.</p>
          <p>By the late 19th century, a class of distinct Taukes (Bosses) emerged, controlling tin mines, revenue farms, and vast commercial networks.</p>
        </div>
      </article>

    </div>

    <div class="tl-dots" id="tlDots" aria-label="Timeline position"></div>
  </div>

  <div class="tl-progress">
    <div class="tl-bar" id="tlBar"></div>
  </div>
</section>

<style>
  .tl-wrap{ margin:32px 0; font-family:system-ui,-apple-system,Segoe UI,Roboto; }
  .tl-header{ margin-bottom: 14px; }
  .tl-header h2{ margin:0 0 6px 0; }
  .tl-sub{ margin:0; opacity:.75; line-height:1.35; }

  .tl-stage{ position: relative; overflow: visible; padding: 12px 56px 44px 56px; }
  .tl-track{
    display:flex; align-items:stretch; gap:16px;
    transform: translateX(0);
    transition: transform 720ms cubic-bezier(.2,.85,.2,1);
    will-change: transform;
  }

  .tl-card{
    width: min(74vw, 560px);
    height: 440px;
    flex: 0 0 auto;
    border-radius: 18px;
    padding: 16px 16px 14px 16px;
    background: rgba(255,255,255,.94);
    border: 1px solid rgba(0,0,0,.12);
    box-shadow: 0 12px 28px rgba(0,0,0,.12);
    overflow: hidden;
    display:flex;
    flex-direction: column;
  }

  .tl-meta{ display:flex; gap:10px; align-items:center; margin-bottom:10px; }
  .tl-tag{ font-size:12px; padding:3px 8px; border-radius:999px; border:1px solid rgba(0,0,0,.18); }
  .tl-date{ font-size:12px; opacity:.7; }
  .tl-card h3{ margin:0 0 10px 0; font-size:18px; }

  .tl-body{ overflow:auto; padding-right: 6px; }
  .tl-body p{ margin:0 0 10px 0; line-height:1.55; opacity:.92; }
  .tl-body p:last-child{ margin-bottom: 0; }

  .tl-card{ transform: scale(.76); opacity:.35; transition: transform 720ms cubic-bezier(.2,.85,.2,1), opacity 720ms; }
  .tl-card.is-near{ transform: scale(.88); opacity:.70; }
  .tl-card.is-active{ transform: scale(1.10); opacity:1; }

  .tl-arrow{
    position:absolute; top: 50%; transform: translateY(-55%);
    width: 44px; height: 44px;
    border-radius: 999px;
    border: 1px solid rgba(0,0,0,.18);
    background: rgba(255,255,255,.92);
    box-shadow: 0 10px 18px rgba(0,0,0,.12);
    cursor:pointer; z-index: 5;
    font-size: 24px; line-height: 44px; text-align:center;
    user-select:none;
  }
  .tl-left{ left: 8px; }
  .tl-right{ right: 8px; }
  .tl-arrow:disabled{ opacity:.35; cursor:not-allowed; }

  .tl-dots{
    position:absolute; left:50%; bottom: 10px; transform: translateX(-50%);
    display:flex; gap:8px; z-index: 5;
    padding: 6px 10px; border-radius: 999px;
    background: rgba(255,255,255,.72);
    border: 1px solid rgba(0,0,0,.10);
    backdrop-filter: blur(6px);
  }
  .tl-dot{ width:8px; height:8px; border-radius:999px; background: rgba(0,0,0,.20); border:0; cursor:pointer; }
  .tl-dot.active{ background: rgba(0,0,0,.60); }

  .tl-progress{ height:6px; background: rgba(0,0,0,.08); border-radius:999px; overflow:hidden; margin-top:10px; }
  .tl-bar{ height:100%; width:0%; background: rgba(0,0,0,.45); transition: width .22s linear; }
</style>

<script>
  const track = document.getElementById("tlTrack");
  const stage = document.getElementById("tlStage");
  const prev = document.getElementById("tlPrev");
  const next = document.getElementById("tlNext");
  const bar  = document.getElementById("tlBar");
  const dotsWrap = document.getElementById("tlDots");
  const cards = Array.from(track.querySelectorAll(".tl-card"));

  let index = 0;

  const dots = cards.map((_, i) => {
    const b = document.createElement("button");
    b.type = "button";
    b.className = "tl-dot";
    b.addEventListener("click", () => goTo(i));
    dotsWrap.appendChild(b);
    return b;
  });

  function getCurrentTranslateX(el){
    const m = new DOMMatrixReadOnly(getComputedStyle(el).transform);
    return m.isIdentity ? 0 : m.m41;
  }

  function layout() {
    const active = cards[index];
    const stageRect = stage.getBoundingClientRect();
    const aRect = active.getBoundingClientRect();

    const stageCenter = stageRect.left + stageRect.width / 2;
    const cardCenter  = aRect.left + aRect.width / 2;

    const dx = stageCenter - cardCenter;
    const currentTx = getCurrentTranslateX(track);
    track.style.transform = `translateX(${currentTx + dx}px)`;

    cards.forEach((c, i) => {
      c.classList.remove("is-active", "is-near");
      if (i === index) c.classList.add("is-active");
      else if (Math.abs(i - index) === 1) c.classList.add("is-near");
    });

    dots.forEach((d, i) => d.classList.toggle("active", i === index));
    bar.style.width = (index / Math.max(1, cards.length - 1)) * 100 + "%";

    prev.disabled = index === 0;
    next.disabled = index === cards.length - 1;
  }

  function goTo(i){
    index = Math.max(0, Math.min(cards.length - 1, i));
    layout();
  }

  prev.addEventListener("click", () => goTo(index - 1));
  next.addEventListener("click", () => goTo(index + 1));

  window.addEventListener("keydown", (e) => {
    if (e.key === "ArrowLeft") goTo(index - 1);
    if (e.key === "ArrowRight") goTo(index + 1);
  });

  let startX = null;
  stage.addEventListener("touchstart", (e) => startX = e.touches[0].clientX, {passive:true});
  stage.addEventListener("touchend", (e) => {
    if (startX == null) return;
    const endX = e.changedTouches[0].clientX;
    const dx = endX - startX;
    if (Math.abs(dx) > 40) goTo(index + (dx < 0 ? 1 : -1));
    startX = null;
  }, {passive:true});

  requestAnimationFrame(() => {
    track.style.transform = "translateX(0px)";
    layout();
  });

  window.addEventListener("resize", () => layout());
</script>

<!-- ====== START: Integrated Maritime + Flight Routes (East Asia start, no auto-zoom) ====== -->

<link href="https://api.mapbox.com/mapbox-gl-js/v3.17.0/mapbox-gl.css" rel="stylesheet" />

<section style="margin:32px 0;">
  <h2 style="margin:0 0 12px 0; font-family:system-ui,-apple-system,Segoe UI,Roboto;">
    Cantonese Migration Routes
  </h2>
  <div id="diaspora-map" style="width:100%; height:540px; border-radius:14px; overflow:hidden;"></div>
</section>

<script src="https://api.mapbox.com/mapbox-gl-js/v3.17.0/mapbox-gl.js"></script>

<script>
mapboxgl.accessToken =
  "pk.eyJ1Ijoia2V2aW5jYXQxMDAiLCJhIjoiY21qbmFyN21yMTYzMzNlcHN5ZHVubTdpbiJ9.m8QPkEMJKLNIMvFyKUgTkw";

/* ===== Your Studio v0 style ===== */
const STYLE_URL = "mapbox://styles/kevincat100/cmjneo20k000v01sxghqb6aqr";

/* ===== High-contrast route colors ===== */
const C_ROUTE1 = "#3d85c6"; // Si Yi → Ayutthaya (maritime, via Cà Mau)
const C_ROUTE2 = "#e69138"; // Ayutthaya → Hà Tiên → Saigon (maritime)
const C_ROUTE3 = "#6a329f"; // Si Yi → Penang → Singapore (maritime)
const C_ROUTE4 = "#666666"; // Vietnam → California (flight, eastward)
const C_ROUTE5 = "#cc0000"; // Hong Kong → California (flight, eastward)

const ROUTE_WIDTH = 2;      // 线更细
const DASH_BASE = [2, 2];   // 虚线基础
const ANIM_MS = 260;        // 流动速度（越大越慢）

/* ===== Init map: East Asia start; NO fitBounds (prevents zoom out) ===== */
const map = new mapboxgl.Map({
  container: "diaspora-map",
  style: STYLE_URL,
  center: [104.9, 12.6], // Cambodia 附近（Phnom Penh 一带）
  zoom: 4.2,
  bearing: 0,            // 取消旋转（避免“歪”）
  pitch: 0               // 取消倾斜
});


map.addControl(new mapboxgl.NavigationControl(), "top-right");

map.on("load", () => {

  /* ===== Points ===== */
  const points = [
    { title:"Si Yi", subtitle:"Sze Yup region of Guangdong", country:"China", coords:[112.98, 22.54] },
    { title:"Hong Kong", subtitle:"", country:"China", coords:[114.1694, 22.3193] },
    { title:"Ayutthaya Kingdom", subtitle:"Ayutthaya", country:"Thailand", coords:[100.5689, 14.3532] },
    { title:"Hà Tiên", subtitle:"", country:"Vietnam", coords:[104.4833, 10.3833] },
    { title:"Saigon", subtitle:"Ho Chi Minh City", country:"Vietnam", coords:[106.6297, 10.8231] },
    { title:"Penang", subtitle:"", country:"Malaysia", coords:[100.3354, 5.4141] },
    { title:"Singapore", subtitle:"", country:"Singapore", coords:[103.8198, 1.3521] },
    { title:"San Francisco", subtitle:"", country:"United States", coords:[-122.4194, 37.7749] }
  ];

  // markers
  points.forEach(p => {
    const el = document.createElement("div");
    el.style.width = "12px";
    el.style.height = "12px";
    el.style.borderRadius = "999px";
    el.style.background = "#111";      // 点用深色更稳，不抢路线颜色
    el.style.border = "2px solid #fff";
    el.style.boxShadow = "0 1px 6px rgba(0,0,0,.25)";

    const popupHtml = `
      <div style="font-family:system-ui; font-size:13px; line-height:1.25;">
        <div style="font-weight:700;">${escapeHtml(p.title)}</div>
        ${p.subtitle ? `<div style="opacity:.8;">${escapeHtml(p.subtitle)}</div>` : ``}
        <div style="opacity:.6;">${escapeHtml(p.country)}</div>
      </div>
    `;

    new mapboxgl.Marker({ element: el })
      .setLngLat(p.coords)
      .setPopup(new mapboxgl.Popup({ offset: 18 }).setHTML(popupHtml))
      .addTo(map);
  });

  /* ===== Helper: add dashed route ===== */
  function addRoute(id, coords, color) {
    map.addSource(id, {
      type: "geojson",
      data: { type:"Feature", geometry:{ type:"LineString", coordinates: coords } }
    });

    map.addLayer({
      id: id + "-line",
      type: "line",
      source: id,
      layout: { "line-cap":"round", "line-join":"round" },
      paint: {
        "line-color": color,
        "line-width": ROUTE_WIDTH,
        "line-dasharray": DASH_BASE
      }
    });
  }

  /* =========================================================
     ROUTE 1 (Maritime): Si Yi → Ayutthaya
     South China Sea →绕 Cà Mau → Gulf of Thailand
     （不走新加坡/马六甲）
  ========================================================= */
  addRoute("r1", [
    [112.98, 22.54],   // Si Yi
    [114.0, 21.8],     // 出海方向
    [113.2, 20.0],
    [112.0, 18.2],
    [111.0, 16.2],
    [110.2, 14.5],
    [109.5, 13.2],
    [109.0, 11.8],
    [108.2, 10.5],
    [106.8, 9.2],
    [105.2, 8.8],      // 贴近 Cà Mau 外海
    [103.6, 8.9],
    [102.0, 9.2],      // 入泰国湾
    [101.0, 10.2],
    [100.6, 12.0],
    [100.5689, 14.3532] // Ayutthaya
  ], C_ROUTE1);

  /* =========================================================
     ROUTE 2 (Maritime): Ayutthaya → Hà Tiên → Saigon
  ========================================================= */
  addRoute("r2", [
    [100.5689, 14.3532],
    [101.0, 12.8],
    [101.6, 11.6],
    [102.4, 10.9],
    [103.3, 10.6],
    [104.0, 10.5],
    [104.4833, 10.3833], // Hà Tiên
    [104.9, 10.0],
    [105.6, 9.6],
    [106.1, 9.8],
    [106.4, 10.2],
    [106.6297, 10.8231]  // Saigon
  ], C_ROUTE2);

  /* =========================================================
     ROUTE 3 (Maritime): Si Yi → Penang → Singapore
  ========================================================= */
  addRoute("r3", [
    [112.98, 22.54],
    [113.6, 20.5],
    [112.6, 18.0],
    [111.0, 15.0],
    [109.5, 12.5],
    [107.8, 10.2],
    [105.8, 8.2],
    [103.5, 6.8],
    [101.8, 6.0],
    [100.3354, 5.4141],  // Penang
    [101.6, 4.1],
    [102.7, 2.7],
    [103.3, 2.0],
    [103.8198, 1.3521]   // Singapore
  ], C_ROUTE3);

  /* =========================================================
     ROUTE 4 (Flight, eastward): Vietnam → California
     说明：用“向东控制点”做航空弧线示意（不考虑日期变更）
  ========================================================= */
  addRoute("r4", [
    [106.6297, 10.8231],   // Saigon
    [122.0, 18.0],
    [138.0, 26.0],
    [154.0, 33.0],
    [170.0, 38.0],
    [186.0, 40.5],
    [202.0, 41.5],
    [218.0, 40.5],
    [232.0, 39.2],
    [237.5806, 37.7749]    // San Francisco (-122.4194 + 360)
  ], C_ROUTE4);

  /* =========================================================
     ROUTE 5 (Flight, eastward): Hong Kong → California
  ========================================================= */
  addRoute("r5", [
    [114.1694, 22.3193],   // Hong Kong
    [130.0, 28.0],
    [146.0, 34.0],
    [162.0, 39.0],
    [176.0, 43.0],
    [190.0, 45.0],
    [206.0, 44.5],
    [222.0, 42.5],
    [233.0, 40.5],
    [237.5806, 37.7749]    // San Francisco
  ], C_ROUTE5);

  /* ===== Animated dashed lines (all routes) ===== */
  const dashSeq = [
    [0,4,3],[0.5,4,2.5],[1,4,2],[1.5,4,1.5],
    [2,4,1],[2.5,4,0.5],[3,4,0]
  ];
  const animatedLayers = ["r1-line","r2-line","r3-line","r4-line","r5-line"];

  let step = 0;
  setInterval(() => {
    const d = dashSeq[step];
    animatedLayers.forEach(id => {
      if (map.getLayer(id)) map.setPaintProperty(id, "line-dasharray", d);
    });
    step = (step + 1) % dashSeq.length;
  }, ANIM_MS);
});

function escapeHtml(str) {
  return String(str).replace(/[&<>"']/g, m =>
    ({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;" }[m])
  );
}
</script>

<!-- ====== END: Integrated Maritime + Flight Routes ====== -->





  <p><em>（You can embed TimelineJS or StoryMapJS here later）</em></p>
</main>

<footer>
  <p>© Cantonese Culture in the Americas</p>
</footer>

</body>
</html>
