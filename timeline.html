<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Timeline | Cantonese Culture in the Americas</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="style.css">
</head>
<body>

<header>
  <div class="site-title">
    <a href="index.html">Cantonese Culture in the Americas</a>
  </div>
  <nav>
    <a href="index.html">Home</a>
    <a href="timeline.html">Timeline</a>
    <a href="research.html">Research</a>
    <a href="archives.html">Archives</a>
    <a href="resources.html">Resources</a>
  </nav>
</header>

<main>
  <h1>Timeline</h1>
  <p>
    This timeline traces major moments in Cantonese migration from Guangdong to Vietnam and the Americas,
    situating cultural practices within historical events.
  </p>
<!-- ====== START: Maritime Migration Routes (FINAL v2) ====== -->

<link href="https://api.mapbox.com/mapbox-gl-js/v3.17.0/mapbox-gl.css" rel="stylesheet" />

<section style="margin:32px 0;">
  <h2 style="margin:0 0 12px 0; font-family:system-ui,-apple-system,Segoe UI,Roboto;">
    Maritime Migration Routes
  </h2>
  <div id="diaspora-map"
       style="width:100%; height:520px; border-radius:14px; overflow:hidden;"></div>
</section>

<script src="https://api.mapbox.com/mapbox-gl-js/v3.17.0/mapbox-gl.js"></script>

<script>
  mapboxgl.accessToken =
    "pk.eyJ1Ijoia2V2aW5jYXQxMDAiLCJhIjoiY21qbmFyN21yMTYzMzNlcHN5ZHVubTdpbiJ9.m8QPkEMJKLNIMvFyKUgTkw";

  const ROUTE_COLOR = "#3d85c6";
  const ROUTE_WIDTH = 2.5;

  const map = new mapboxgl.Map({
    container: "diaspora-map",
    style: "mapbox://styles/mapbox/light-v11",
    center: [105, 14],
    zoom: 3
  });

  map.addControl(new mapboxgl.NavigationControl(), "top-right");

  map.on("load", () => {

    /* ===== Points ===== */
    const points = [
      { title:"Guangdong", subtitle:"", country:"China", coords:[113.2644, 23.1291] },
      { title:"Ayutthaya Kingdom", subtitle:"Ayutthaya", country:"Thailand", coords:[100.5689, 14.3532] },
      { title:"Hà Tiên", subtitle:"", country:"Vietnam", coords:[104.4833, 10.3833] },
      { title:"Saigon", subtitle:"Ho Chi Minh City", country:"Vietnam", coords:[106.6297, 10.8231] }
    ];

    const bounds = new mapboxgl.LngLatBounds();

    points.forEach(p => {
      const el = document.createElement("div");
      el.style.width = "12px";
      el.style.height = "12px";
      el.style.borderRadius = "999px";
      el.style.background = ROUTE_COLOR;
      el.style.border = "2px solid #fff";
      el.style.boxShadow = "0 1px 6px rgba(0,0,0,.25)";

      const popupHtml = `
        <div style="font-family:system-ui; font-size:13px; line-height:1.25;">
          <div style="font-weight:700; margin-bottom:4px;">${p.title}</div>
          ${p.subtitle ? `<div style="opacity:.85; margin-bottom:4px;">${p.subtitle}</div>` : ``}
          <div style="opacity:.7;">${p.country}</div>
        </div>
      `;

      new mapboxgl.Marker({ element: el })
        .setLngLat(p.coords)
        .setPopup(new mapboxgl.Popup({ offset: 18 }).setHTML(popupHtml))
        .addTo(map);

      bounds.extend(p.coords);
    });

    map.fitBounds(bounds, { padding: 110 });

    /* ===== Route 1: Guangzhou → Ayutthaya
       南海 → 绕金瓯角（Cà Mau）→ 泰国湾（不走马六甲） ===== */
    const route1 = [
      [113.2644, 23.1291], // Guangzhou
      [114.5, 21.5],       // 南海出口
      [112.0, 18.5],       // 南海
      [110.0, 14.0],       // 越南中部外海
      [109.0, 11.0],       // 越南南部外海
      [104.5, 8.8],        // 绕过 Cà Mau（金瓯角）
      [101.5, 9.5],        // 泰国湾入口
      [100.9, 11.5],       // 泰国湾内部
      [100.5689, 14.3532]  // Ayutthaya
    ];

    map.addSource("route-1", {
      type: "geojson",
      data: { type:"Feature", geometry:{ type:"LineString", coordinates: route1 } }
    });

    map.addLayer({
      id: "route-1-line",
      type: "line",
      source: "route-1",
      layout: { "line-cap":"round", "line-join":"round" },
      paint: {
        "line-color": ROUTE_COLOR,
        "line-width": ROUTE_WIDTH,
        "line-dasharray": [2, 2]
      }
    });

    /* ===== Route 2: Ayutthaya → Hà Tiên → Saigon ===== */
    const route2 = [
      [100.5689, 14.3532],
      [101.2, 12.2],
      [102.5, 11.0],
      [104.0, 10.5],
      [104.4833, 10.3833], // Hà Tiên
      [105.4, 9.5],
      [106.2, 9.9],
      [106.6297, 10.8231]  // Saigon
    ];

    map.addSource("route-2", {
      type: "geojson",
      data: { type:"Feature", geometry:{ type:"LineString", coordinates: route2 } }
    });

    map.addLayer({
      id: "route-2-line",
      type: "line",
      source: "route-2",
      layout: { "line-cap":"round", "line-join":"round" },
      paint: {
        "line-color": ROUTE_COLOR,
        "line-width": ROUTE_WIDTH,
        "line-dasharray": [2, 2]
      }
    });

    /* ===== Animated dashed lines ===== */
    const dashSeq = [
      [0,4,3],[0.5,4,2.5],[1,4,2],[1.5,4,1.5],
      [2,4,1],[2.5,4,0.5],[3,4,0]
    ];

    let step = 0;
    setInterval(() => {
      const d = dashSeq[step];
      map.setPaintProperty("route-1-line","line-dasharray", d);
      map.setPaintProperty("route-2-line","line-dasharray", d);
      step = (step + 1) % dashSeq.length;
    }, 220);
  });
</script>

<!-- ====== END: Maritime Migration Routes (FINAL v2) ====== -->


  <p><em>（You can embed TimelineJS or StoryMapJS here later）</em></p>
</main>

<footer>
  <p>© Cantonese Culture in the Americas</p>
</footer>

</body>
</html>
