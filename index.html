<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Cantonese Culture in the Americas</title>

<link href="https://api.mapbox.com/mapbox-gl-js/v3.17.0/mapbox-gl.css" rel="stylesheet" />

<style>
:root{
  --bg:#fff;--text:#0b0f19;--muted:#4b5563;--line:#e5e7eb;
  --blue-100:#e6f2ff;--shadow:0 10px 30px rgba(0,0,0,.06);
  --radius:18px;--max:1220px;
  --font:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Arial,"PingFang SC","Microsoft YaHei",sans-serif;
}
*{box-sizing:border-box}
body{margin:0;font-family:var(--font);background:var(--bg);color:var(--text);line-height:1.5}
a{text-decoration:none;color:inherit}
.container{max-width:var(--max);margin:0 auto;padding:0 24px}

/* Header */
.header{position:sticky;top:0;z-index:1000;background:rgba(255,255,255,.9);
backdrop-filter:saturate(180%) blur(10px);border-bottom:1px solid var(--line)}
.nav{height:76px;display:flex;align-items:center;justify-content:space-between}
.brand{display:flex;align-items:center;gap:12px}
.brand img{width:44px;height:44px;border-radius:12px}
.nav-right{display:flex;align-items:center;gap:18px}
.nav-item{position:relative;padding:10px 12px;border-radius:12px;font-weight:600;font-size:14px}
.nav-item:hover{background:#f4f6f8}
.dropdown{display:none;position:absolute;top:44px;left:0;width:360px;
background:#fff;border:1px solid var(--line);border-radius:16px;padding:10px;box-shadow:var(--shadow)}
.nav-item:hover .dropdown{display:block}
.dropdown a{display:block;padding:10px 12px;border-radius:12px;font-size:13px}
.dropdown a:hover{background:var(--blue-100)}
.dropdown span{display:block;font-size:12px;color:var(--muted)}
.lang{border:1px solid var(--line);padding:8px 12px;border-radius:999px;cursor:pointer}

/* Hero */
.hero{padding:72px 0}
.hero h1{font-size:64px;margin:0 0 16px;font-weight:800}
.hero .lead{font-size:20px;color:var(--muted);max-width:820px}
.hero p{max-width:900px}
.cta{display:inline-block;margin-top:16px;padding:12px 16px;border:1px solid var(--line);border-radius:14px;font-weight:700}

/* Layout */
.row{display:grid;grid-template-columns:1fr 1fr;gap:28px;margin-top:36px}
.card{border:1px solid var(--line);border-radius:var(--radius);padding:18px;background:#fff}
.phase{border:1px solid var(--line);border-radius:16px;padding:14px;margin-bottom:12px}
.phase:hover{background:var(--blue-100)}
#diaspora-map{width:100%;height:540px;border-radius:18px}

.mosaic img{width:100%;height:260px;object-fit:cover;border-radius:22px;margin-bottom:18px}

@media(max-width:900px){.row{grid-template-columns:1fr}.hero h1{font-size:44px}}
</style>
</head>

<body>
<header class="header">
<div class="container">
<nav class="nav">
<a class="brand" href="index.html">
<img src="assets/logo.jpeg" />
<strong>Cantonese in Americas</strong>
</a>

<div class="nav-right">
<div class="nav-item">Timeline
  <div class="dropdown">
    <a href="phase1.html">Phase I <span>17th–19th Centuries</span></a>
    <a href="phase2.html">Phase II <span>17th–19th Centuries</span></a>
    <a href="phase3.html">Phase III <span>17th–19th Centuries</span></a>
    <a href="phase4.html">Phase IV <span>17th–19th Centuries</span></a>
  </div>
</div>

<div class="nav-item">Research
  <div class="dropdown" style="width:280px">
    <a href="oral.html">Oral History</a>
    <a href="culture.html">Culture Record</a>
    <a href="influence.html">Influence Research</a>
  </div>
</div>

<a class="nav-item" href="archives.html">Archives</a>
<a class="nav-item" href="resources.html">Resources</a>
<div class="lang" onclick="toggleLang()">EN / 中文</div>
</div>
</nav>
</div>
</header>

<main class="hero">
<div class="container">
<h1>Cantonese culture in the Americas</h1>
<p class="lead">Public History · Oral History · Cultural Research</p>

<p>Since the seventeenth century, hundreds of thousands of Cantonese migrants from Guangdong’s coastal region crossed the South China Sea and the Pacific.</p>
<p>This project documents how Cantonese culture traveled, transformed, and endured across generations.</p>

<a class="cta" href="introduction.html">View the full introduction →</a>

<div class="row">
<div class="card">
  <h2>Timeline</h2>
  <a class="phase" href="phase1.html">Phase I</a>
  <a class="phase" href="phase2.html">Phase II</a>
  <a class="phase" href="phase3.html">Phase III</a>
  <a class="phase" href="phase4.html">Phase IV</a>
</div>

<div class="card" style="padding:0">
  <div id="diaspora-map"></div>
</div>
</div>
</div>
</main>

<script src="https://api.mapbox.com/mapbox-gl-js/v3.17.0/mapbox-gl.js"></script>

<!-- ====== START: Integrated Maritime + Flight Routes (East Asia start, no auto-zoom) ====== -->

<link href="https://api.mapbox.com/mapbox-gl-js/v3.17.0/mapbox-gl.css" rel="stylesheet" />

<section style="margin:32px 0;">
  <h2 style="margin:0 0 12px 0; font-family:system-ui,-apple-system,Segoe UI,Roboto;">
    Maritime & Flight Migration Routes
  </h2>
  <div id="diaspora-map" style="width:100%; height:540px; border-radius:14px; overflow:hidden;"></div>
</section>

<script src="https://api.mapbox.com/mapbox-gl-js/v3.17.0/mapbox-gl.js"></script>

<script>
mapboxgl.accessToken =
  "pk.eyJ1Ijoia2V2aW5jYXQxMDAiLCJhIjoiY21qbmFyN21yMTYzMzNlcHN5ZHVubTdpbiJ9.m8QPkEMJKLNIMvFyKUgTkw";

/* ===== Your Studio v0 style ===== */
const STYLE_URL = "mapbox://styles/kevincat100/cmjneo20k000v01sxghqb6aqr";

/* ===== High-contrast route colors ===== */
const C_ROUTE1 = "#3d85c6"; // Si Yi → Ayutthaya (maritime, via Cà Mau)
const C_ROUTE2 = "#e69138"; // Ayutthaya → Hà Tiên → Saigon (maritime)
const C_ROUTE3 = "#6a329f"; // Si Yi → Penang → Singapore (maritime)
const C_ROUTE4 = "#666666"; // Vietnam → California (flight, eastward)
const C_ROUTE5 = "#cc0000"; // Hong Kong → California (flight, eastward)

const ROUTE_WIDTH = 2;      // 线更细
const DASH_BASE = [2, 2];   // 虚线基础
const ANIM_MS = 260;        // 流动速度（越大越慢）

/* ===== Init map: East Asia start; NO fitBounds (prevents zoom out) ===== */
const map = new mapboxgl.Map({
  container: "diaspora-map",
  style: STYLE_URL,
  center: [104.9, 12.6], // Cambodia 附近（Phnom Penh 一带）
  zoom: 4.2,
  bearing: 0,            // 取消旋转（避免“歪”）
  pitch: 0               // 取消倾斜
});

map.addControl(new mapboxgl.NavigationControl(), "top-right");

map.on("load", () => {

  /* ===== Points ===== */
  const points = [
    { title:"Si Yi", subtitle:"Sze Yup region of Guangdong", country:"China", coords:[112.98, 22.54] },
    { title:"Hong Kong", subtitle:"", country:"China", coords:[114.1694, 22.3193] },
    { title:"Ayutthaya Kingdom", subtitle:"Ayutthaya", country:"Thailand", coords:[100.5689, 14.3532] },
    { title:"Hà Tiên", subtitle:"", country:"Vietnam", coords:[104.4833, 10.3833] },
    { title:"Saigon", subtitle:"Ho Chi Minh City", country:"Vietnam", coords:[106.6297, 10.8231] },
    { title:"Penang", subtitle:"", country:"Malaysia", coords:[100.3354, 5.4141] },
    { title:"Singapore", subtitle:"", country:"Singapore", coords:[103.8198, 1.3521] },
    { title:"San Francisco", subtitle:"", country:"United States", coords:[-122.4194, 37.7749] }
  ];

  // markers
  points.forEach(p => {
    const el = document.createElement("div");
    el.style.width = "12px";
    el.style.height = "12px";
    el.style.borderRadius = "999px";
    el.style.background = "#111";      // 点用深色更稳，不抢路线颜色
    el.style.border = "2px solid #fff";
    el.style.boxShadow = "0 1px 6px rgba(0,0,0,.25)";

    const popupHtml = `
      <div style="font-family:system-ui; font-size:13px; line-height:1.25;">
        <div style="font-weight:700;">${escapeHtml(p.title)}</div>
        ${p.subtitle ? `<div style="opacity:.8;">${escapeHtml(p.subtitle)}</div>` : ``}
        <div style="opacity:.6;">${escapeHtml(p.country)}</div>
      </div>
    `;

    new mapboxgl.Marker({ element: el })
      .setLngLat(p.coords)
      .setPopup(new mapboxgl.Popup({ offset: 18 }).setHTML(popupHtml))
      .addTo(map);
  });

  /* ===== Helper: add dashed route ===== */
  function addRoute(id, coords, color) {
    map.addSource(id, {
      type: "geojson",
      data: { type:"Feature", geometry:{ type:"LineString", coordinates: coords } }
    });

    map.addLayer({
      id: id + "-line",
      type: "line",
      source: id,
      layout: { "line-cap":"round", "line-join":"round" },
      paint: {
        "line-color": color,
        "line-width": ROUTE_WIDTH,
        "line-dasharray": DASH_BASE
      }
    });
  }

  /* =========================================================
     ROUTE 1 (Maritime): Si Yi → Ayutthaya
     South China Sea →绕 Cà Mau → Gulf of Thailand
     （不走新加坡/马六甲）
  ========================================================= */
  addRoute("r1", [
    [112.98, 22.54],   // Si Yi
    [114.0, 21.8],     // 出海方向
    [113.2, 20.0],
    [112.0, 18.2],
    [111.0, 16.2],
    [110.2, 14.5],
    [109.5, 13.2],
    [109.0, 11.8],
    [108.2, 10.5],
    [106.8, 9.2],
    [105.2, 8.8],      // 贴近 Cà Mau 外海
    [103.6, 8.9],
    [102.0, 9.2],      // 入泰国湾
    [101.0, 10.2],
    [100.6, 12.0],
    [100.5689, 14.3532] // Ayutthaya
  ], C_ROUTE1);

  /* =========================================================
     ROUTE 2 (Maritime): Ayutthaya → Hà Tiên → Saigon
  ========================================================= */
  addRoute("r2", [
    [100.5689, 14.3532],
    [101.0, 12.8],
    [101.6, 11.6],
    [102.4, 10.9],
    [103.3, 10.6],
    [104.0, 10.5],
    [104.4833, 10.3833], // Hà Tiên
    [104.9, 10.0],
    [105.6, 9.6],
    [106.1, 9.8],
    [106.4, 10.2],
    [106.6297, 10.8231]  // Saigon
  ], C_ROUTE2);

  /* =========================================================
     ROUTE 3 (Maritime): Si Yi → Penang → Singapore
  ========================================================= */
  addRoute("r3", [
    [112.98, 22.54],
    [113.6, 20.5],
    [112.6, 18.0],
    [111.0, 15.0],
    [109.5, 12.5],
    [107.8, 10.2],
    [105.8, 8.2],
    [103.5, 6.8],
    [101.8, 6.0],
    [100.3354, 5.4141],  // Penang
    [101.6, 4.1],
    [102.7, 2.7],
    [103.3, 2.0],
    [103.8198, 1.3521]   // Singapore
  ], C_ROUTE3);

  /* =========================================================
     ROUTE 4 (Flight, eastward): Vietnam → California
     说明：用“向东控制点”做航空弧线示意（不考虑日期变更）
  ========================================================= */
  addRoute("r4", [
    [106.6297, 10.8231],   // Saigon
    [122.0, 18.0],
    [138.0, 26.0],
    [154.0, 33.0],
    [170.0, 38.0],
    [186.0, 40.5],
    [202.0, 41.5],
    [218.0, 40.5],
    [232.0, 39.2],
    [237.5806, 37.7749]    // San Francisco (-122.4194 + 360)
  ], C_ROUTE4);

  /* =========================================================
     ROUTE 5 (Flight, eastward): Hong Kong → California
  ========================================================= */
  addRoute("r5", [
    [114.1694, 22.3193],   // Hong Kong
    [130.0, 28.0],
    [146.0, 34.0],
    [162.0, 39.0],
    [176.0, 43.0],
    [190.0, 45.0],
    [206.0, 44.5],
    [222.0, 42.5],
    [233.0, 40.5],
    [237.5806, 37.7749]    // San Francisco
  ], C_ROUTE5);

  /* ===== Animated dashed lines (all routes) ===== */
  const dashSeq = [
    [0,4,3],[0.5,4,2.5],[1,4,2],[1.5,4,1.5],
    [2,4,1],[2.5,4,0.5],[3,4,0]
  ];
  const animatedLayers = ["r1-line","r2-line","r3-line","r4-line","r5-line"];

  let step = 0;
  setInterval(() => {
    const d = dashSeq[step];
    animatedLayers.forEach(id => {
      if (map.getLayer(id)) map.setPaintProperty(id, "line-dasharray", d);
    });
    step = (step + 1) % dashSeq.length;
  }, ANIM_MS);
});

function escapeHtml(str) {
  return String(str).replace(/[&<>"']/g, m =>
    ({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;" }[m])
  );
}
</script>

<!-- ====== END: Integrated Maritime + Flight Routes ====== -->

function toggleLang(){alert("语言切换已预留（可后续补充）")}
</script>
</body>
</html>
